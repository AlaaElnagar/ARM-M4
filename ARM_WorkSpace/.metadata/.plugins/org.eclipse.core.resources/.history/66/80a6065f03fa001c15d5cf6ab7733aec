
#include "LSTD_TYPES.h"

#include "MRCC_interface.h"
#include "MSYSTICK_Interface.h"
#include "MGPIO_interface.h"
#include "MNVIC_Interface.h"
#include "MEXTI_interface.h"


void _delay_us( u32 Copy_u32Time ) ;
void _delay_ms( u32 Copy_u32Time ) ;

#define EXTI0     6
#define EXTI1     7



int main(void)
{
	/*System Clock is 16MHz from HSI*/
	MRCC_voidInitSystemClk();

	/*Enable GPIO Peripheral clock*/
	MRCC_voidEnablePeripheralClock(AHB1,_PERIPHERAL_EN_GPIOA ) ;
	MRCC_voidEnablePeripheralClock(AHB1,_PERIPHERAL_EN_GPIOB ) ;
	MRCC_voidEnablePeripheralClock(APB2, PERIPHERAL_EN_SYSCFG) ;

	/*Set Pin Mode --> Output*/
	MGPIO_voidSetPinMode(_GPIOA_PORT, _PIN_1, _MODE_OUTPUT) ;

	/*Set Pin Mode --> Input*/
	MGPIO_voidSetPinMode(_GPIOA_PORT, _PIN_0, _MODE_INPUT) ;   //EXTI0
	MGPIO_voidSetPinMode(_GPIOB_PORT, _PIN_1, _MODE_INPUT) ;   //EXTI1

	/*Input Pull Type*/
	MGPIO_voidSetPullType(_GPIOA_PORT, _PIN_0, _PULL_UP);
	MGPIO_voidSetPullType(_GPIOB_PORT, _PIN_1, _PULL_UP);

	/*Out put Push Pull*/
	MGPIO_voidSetPinOutPutType(_GPIOA_PORT,_PIN_1,_OUTPUT_TYPE_PUSH_PULL);

	/*Pin Speed*/
	MGPIO_voidSetPinOutSpeed(_GPIOA_PORT, _PIN_1, _OUTPUT_SPEED_LOW);





	//Initialize Interrupt Group
	MNVIC_voidInitInterruptGroup(NVIC_GroupMode_g16s0);
	//NO_SUB_PRIORITY
	MNVIC_voidSetInterruptPriority(EXTI0,NVIC_GroupMode_g16s0, 1 , 0);
	MNVIC_voidSetInterruptPriority(EXTI1,NVIC_GroupMode_g16s0, 2 , 0);   //High Priority

	//Enable Peripheral Interrupt
	MNVIC_voidEnableInterrupt(EXTI0);
	MNVIC_voidEnableInterrupt(EXTI1);

	/* Loop forever */
	while(1)
	{
	}
}

void _delay_ms( u32 Copy_u32Time ){

	MSTK_voidInit();
	/* Disable INT */
	MSTK_voidINTStatus( MSTK_INT_DIS );
	MSTK_voidStart( Copy_u32Time * 1000 );
	/* Wiat Flag Polling */
	while( MSTK_u8ReadFlag() == 0 );

}


/* Suppose That The Clock System (AHB) = 8MHZ EXT & The Systick Clock Is = AHB/8 */
void _delay_us( u32 Copy_u32Time ){

	MSTK_voidInit();
	/* Disable INT */
	MSTK_voidINTStatus( MSTK_INT_DIS );
	MSTK_voidStart( Copy_u32Time);
	/* Wiat Flag Polling */
	while( MSTK_u8ReadFlag() == 0 );

}

u8 volatile Flag = 0;

void EXT0_CALLBACK(){

	if( Flag == 0 ){

		MGPIO_voidWriteData(_GPIOA_PORT, _PIN_0, _HIGH) ;
		Flag = 1 ;

	}

}

void EXT1_CALLBACK(){

	if( Flag == 1 ){

		MGPIO_voidWriteData(_GPIOA_PORT, _PIN_0, _LOW) ;
		Flag = 0 ;

	}

}

int main(void)
{

	MRCC_VidInit();
	MRCC_VidEnablePeripheralClock( APB2_BUS , GPIOA_RCC );
	MRCC_VidEnablePeripheralClock( APB2_BUS , GPIOB_RCC );
	MRCC_VidEnablePeripheralClock( APB2_BUS , AFIO_RCC  );

	MGPIO_VidSetPinDirection( GPIOA , PIN0 , INPUT_PULLUP_PULLDOWN );
	MGPIO_VidSetPinDirection( GPIOB , PIN1 , INPUT_PULLUP_PULLDOWN );

	MGPIO_VidSetPinValue( GPIOA , PIN0 , HIGH );
	MGPIO_VidSetPinValue( GPIOB , PIN1 , HIGH );

	MGPIO_VidSetPinDirection( GPIOA , PIN1 , OUTPUT_SPEED_2MHZ_PP );

	MNVIC_VidSetPriority( EXT0 , 1 , NO_SUB_PRIORITY , GROUP3 );
	MNVIC_VidSetPriority( EXT1 , 2 , NO_SUB_PRIORITY , GROUP3 );

	MNVIC_VidEnablePeripheral( EXT0 );
	MNVIC_VidEnablePeripheral( EXT1 );

	AFIO_VidSetEXTIConfiguration( EXTI_LINE0 , GPIOA );
	AFIO_VidSetEXTIConfiguration( EXTI_LINE1 , GPIOB );

	EXTI0_VidSetCallBack( EXT0_CALLBACK );
	EXTI1_VidSetCallBack( EXT1_CALLBACK );

	EXTI_VidInit( EXTI_LINE0 , FALLING_EDGE );
	EXTI_VidInit( EXTI_LINE1 , FALLING_EDGE );

	while(1);

	return 0;
}










